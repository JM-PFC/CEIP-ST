{% extends 'BackendBundle:Default:index.html.twig' %}

{% block head %}{% endblock %}
{% block stylesheets %}{% endblock %}
    
{% block javascript %}
    <script>
    $("#añadir_modal").hover(function() {
        $(this).find("#img_1").addClass("oculto");
        $(this).find("#img_2").removeClass("oculto");

    }, function() {
        $(this).find("#img_2").addClass("oculto");
        $(this).find("#img_1").removeClass("oculto");    }
    );

    $("#asignatura_curso_dialog").dialog(
       {
        bgiframe: true,
        autoOpen: false,
        height: 504,
        width: 900,
        modal: true,
        resizable: false,
       }
    );
    $('#asignatura_curso_dialog').on('dialogclose', function(event) {
        $('#asignatura_curso_dialog').empty();
    });

    $("#asignaturas_cursos #contenedor_registro[idcurso='1']").removeClass('oculto');
    $("#asignaturas_cursos button[id='1']").addClass('elected');
    //Efecto del botón pulsado en la lista.
    $(document).on('click',"#asignaturas_cursos .contenido_lista button",function(event){
        event.preventDefault();
        id=$(this).attr("id");
        $("#asignaturas_cursos #contenedor_registro").addClass('oculto');
        $("#asignaturas_cursos button").removeClass('elected');
        $(this).addClass('elected');
        $("#asignaturas_cursos #contenedor_registro[idcurso='"+id+"']").removeClass('oculto');
    });

    //Comprobacón de existencia de cursos.
    if($("#asignaturas_cursos .contenido_lista button").size()==0){

        // Se establece las variables con los audios para las notificaciones.
        if (navigator.userAgent.search("Firefox") >= 0) { //Firefox sólo admite archivos .ogg
            var error = new Audio();
            error.src = "/Symfony/web/bundles/backend/sounds/error.ogg";
        }
        else{
            var error = new Audio();
            error.src = "/Symfony/web/bundles/backend/sounds/error.mp3";
        }
        error.play();
          swal({
            title: "Cursos no registrados",
            text: 'Actualmente no existe ningún curso registrado en el sistema. Para poder asignar las asignaturas debe registrar un curso.',
            type: "error",
            confirmButtonColor: color,
            html: true
          });          
        $("#tabs ul li[aria-selected='true'] span").trigger("click");
    }
    
    //Comprobacón de existencia de asignaturas.
    if({{numAsignaturas|json_encode()|raw}}==0){

        // Se establece las variables con los audios para las notificaciones.
        if (navigator.userAgent.search("Firefox") >= 0) { //Firefox sólo admite archivos .ogg
            var error = new Audio();
            error.src = "/Symfony/web/bundles/backend/sounds/error.ogg";
        }
        else{
            var error = new Audio();
            error.src = "/Symfony/web/bundles/backend/sounds/error.mp3";
        }
        error.play();
          swal({
            title: "Asignaturas no registradas",
            text: 'Actualmente no existen asignaturas registrada en el sistema. Debe registrar las asignaturas para poder asignarlas.',
            type: "error",
            confirmButtonColor: color,
            html: true
          });          
        $("#tabs ul li[aria-selected='true'] span").trigger("click");
    }


    </script>
{% endblock %}

{% block body -%}
    <div id="asignaturas_cursos">
    <div class="parent_no_form">
    <div class="child">
      <div class="simple_column">
        <div class="block_insert">
            <h2>Asignaturas por cursos</h2>
            <ul>
                <li>Para <span>mostrar</span> un curso pulse sobre el nombre del curso correspondiente en la lista de cursos.</li>
                <li>Para <span>añadir</span> una nueva asignatura pulse sobre el icono de añadir <img id="img_1" class="add_registro" src="/Symfony/web/bundles/backend/images/menu/añadir_azul.png"> en el bloque correspondiente.</li>
                <li>Para <span>modificar</span> o <span>eliminar</span> una asignatura seleccione la asignatura correspondiente.</li>
            </ul>
        </div> 
      </div>
      <div class="lista_cursos">
        <div class="cabecera_lista">
        Cursos
        </div class="contenido_lista">
        <div class="contenido_lista">
            {% for entity in entities %}
                <button class="buttonface" id="{{ loop.index }}">{{ entity.curso ~ " " ~ entity.nivel }}   </button>
            {% endfor %}
        </div>
      </div>
    {% for entity in entities %}
      <div class="derecha contenedor_registro oculto" idcurso="{{ loop.index }}"id="contenedor_registro">  
        <div>
            <div id="cabecera_lista" curso="{{ entity.id}}">
                <h2>{{ entity.curso ~ " " ~ entity.nivel }}
                    <a id="añadir_modal" title="Añadir Asignaturas" href="javascript:void(0);">
                        <img id="img_1" class="add_registro" src="{{ asset('bundles/backend/images/menu/añadir_azul.png')}}">
                        <img id="img_2" class="add_registro oculto" src="{{ asset('bundles/backend/images/menu/añadir_azul2.png')}}">
                    </a>
                </h2>
            </div>
            <div id="lista_asignaturas">
                <table class="records_list">
                    <thead>
                    <tr>
                        <th>Asignatura</th>
                        <th>Tipo</th>
                        <th>Nº Módulos</th>
                    </tr>
                    </thead>
                </table>
                <div class="inner_table">
                    <table id="lista_color">
                        {{render (controller('BackendBundle:Asignatura:AsignaturasCurso',{'id': entity.id }))}}
                    </table>
                </div>
            </div>
        </div>          
      </div>
    {% endfor %}

      <div id="asignatura_curso_dialog" title="Asignaturas por curso">
    </div>
    </div>
    </div>
    {% endblock %}