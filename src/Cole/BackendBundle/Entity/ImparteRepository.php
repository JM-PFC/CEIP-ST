<?php

namespace Cole\BackendBundle\Entity;

use Doctrine\ORM\EntityRepository;

/**
 * ImparteRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class ImparteRepository extends EntityRepository
{

	public function findByCurso($curso)
	{
		return $this->getEntityManager()->createQuery(
		'SELECT i FROM BackendBundle:Imparte i WHERE i.curso=:curso')
		->setParameters(array(
			'curso' => $curso))
		->getResult();
	}

	public function findByDatos($dia_semanal,$ini,$fin,$profesor)
	{
		return $this->getEntityManager()->createQuery(
			'SELECT i FROM BackendBundle:Imparte i INNER JOIN i.horario h WHERE i.profesor=:profesor and i.dia_semanal=:dia_semanal and h.inicio=:ini and h.fin=:fin')
		->setParameters(array(
			'profesor' => $profesor,
			'dia_semanal' => $dia_semanal, 
			'ini' => $ini,
			'fin' => $fin))
		->setMaxResults(1)
		->getOneOrNullResult();
	}

	//Se obtiene los profesores que tienen asignado un curso.
    //$entities_active = $em->getRepository('BackendBundle:Imparte')->findAsignaciones();
	
	public function findAsignaciones()
	{
		return $this->getEntityManager()->createQuery(
		'SELECT i FROM BackendBundle:Imparte i INNER JOIN i.grupo g INNER JOIN g.curso c GROUP BY i.profesor, c.id')
		->getResult();
	}

	public function findByGrupoAndAsignatura($grupo,$asignatura)
	{
		return $this->getEntityManager()->createQuery(
		'SELECT i FROM BackendBundle:Imparte i INNER JOIN i.grupo g INNER JOIN i.asignatura a WHERE g=:grupo AND a=:asignatura')
		->setParameters(array(
			'grupo' => $grupo,
			'asignatura'=>$asignatura))
		->setMaxResults(1)
		->getOneOrNullResult();
	}



}
